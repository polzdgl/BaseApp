@page "/users"
@using BaseApp.Data.User.Dtos
@using BaseApp.Web.Shared
@attribute [StreamRendering(true)]

<h3>User List</h3>

@if (IsLoading)
{
    <p>Loading...</p>
}
else if (HasError)
{
    <div class="alert alert-danger">
        <h4 class="alert-heading">Error</h4>
        <p>Failed to load user list. Please try again later.</p>
        @if (!string.IsNullOrEmpty(ErrorMessage))
        {
            <hr />
            <p class="mb-0">@ErrorMessage</p>
        }
    </div>
}
else if (!users.Any())
{
    <p>No users found.</p>
}
else
{
    <RadzenDataGrid AllowFiltering="true" AllowColumnResize="true" AllowAlternatingRows="false"
                    FilterMode="FilterMode.Advanced" AllowSorting="true" PageSize="5" AllowPaging="true"
                    PagerHorizontalAlign="HorizontalAlign.Left" ShowPagingSummary="true"
                    Data="@users" ColumnWidth="300px" LogicalFilterOperator="LogicalFilterOperator.Or"
                    SelectionMode="DataGridSelectionMode.Single" @bind-Value=@selectedUsers>
        <Columns>
            <RadzenDataGridColumn Property="@nameof(UserDto.Id)" Filterable="false" Title="ID" Frozen="true" Width="80px" TextAlign="TextAlign.Center" />
            <RadzenDataGridColumn Property="@nameof(UserDto.UserName)" Title="User Name" Frozen="true" Width="160px" />
            <RadzenDataGridColumn Property="@nameof(UserDto.FirstName)" Title="First Name" Width="160px" />
            <RadzenDataGridColumn Property="@nameof(UserDto.LastName)" Title="Last Name" Width="160px" />
            <RadzenDataGridColumn Property="@nameof(UserDto.Email)" Title="Email" Width="200px" />
            <RadzenDataGridColumn Property="@nameof(UserDto.PhoneNumber)" Title="Phone" Width="160px" />
            <RadzenDataGridColumn Property="@nameof(UserDto.Age)" Title="Age" Width="160px" />
            <RadzenDataGridColumn Property="@nameof(UserDto.IsActive)" Title="Is Active" Width="160px" />

            <!-- Button Column -->
            <RadzenDataGridColumn Title="Actions" Width="200px" Filterable="false" Sortable="false">
                <Template Context="user">
                    <!-- Edit Button -->
                    <RadzenButton Text="Edit" ButtonStyle="ButtonStyle.Primary" Click=@(() => NavigateToEdit(user.Id)) />
                    <!-- Delete Button -->
                    <RadzenButton Text="Delete" ButtonStyle="ButtonStyle.Danger" Click=@(() => ShowDeletePopup(user.Id, user.UserName)) />   
                </Template>
            </RadzenDataGridColumn>
        </Columns>
    </RadzenDataGrid>

    <div class="d-flex justify-content-end align-items-center gap-3">
        <!-- Page Size Dropdown -->
        <div class="d-flex align-items-center">
            <label for="pageSize" class="me-2 mb-0">Page Size:</label>
            <select id="pageSize" class="form-select form-select-sm w-auto" @onchange="UpdatePageSize">
                <option value="10" selected>10</option>
                <option value="50">50</option>
                <option value="100">100</option>
            </select>
        </div>

        <!-- Pagination Controls -->
        <nav>
            <ul class="pagination mb-0">
                <li class="page-item @(CurrentPage == 1 ? "disabled" : "")">
                    <button class="page-link" @onclick="() => LoadPage(CurrentPage - 1)">Previous</button>
                </li>
                @for (int i = 1; i <= TotalPages; i++)
                {
                    <li class="page-item @(i == CurrentPage ? "active" : "")">
                        <button class="page-link" @onclick="() => LoadPage(i)">@i</button>
                    </li>
                }
                <li class="page-item @(CurrentPage == TotalPages ? "disabled" : "")">
                    <button class="page-link" @onclick="() => LoadPage(CurrentPage + 1)">Next</button>
                </li>
            </ul>
        </nav>
    </div>
}

<div class="figure-caption">
    <a class="btn btn-primary" role="button" href="/users/create">Create User</a>
</div>

<DeleteConfirmation @ref="DeleteConfirmationPopup"
                    Title="Confirm User Deletion"
                    OnConfirm="DeleteUser"
                    OnCancel="HandleCancel" />
